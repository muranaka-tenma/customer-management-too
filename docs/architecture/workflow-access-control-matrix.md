# 最強タスク管理ツール - ワークフローアクセス制御マトリックス

## 🎯 マトリックス概要

**対象システム**: 最強タスク管理ツール  
**制御対象**: ワークフロー管理の全操作権限  
**設計思想**: 個人の完全自由 + 共有タスクの適切な統制

## 📊 総合権限マトリックス

### 凡例
- ✅ **完全許可**: 制限なし実行可能
- 🔒 **承認必要**: 上位権限者の承認が必要
- 👁️ **閲覧のみ**: 読み取り専用
- ❌ **禁止**: アクセス不可
- 🎯 **条件付き**: 特定条件下でのみ許可

## 1️⃣ 個人ワークフロー操作権限

| 操作項目 | USER | TEAM_LEADER | MANAGER | COMPANY_LEADER |
|---------|------|-------------|---------|----------------|
| **個人ワークフロー作成** | ✅ 無制限 | ✅ 無制限 | ✅ 無制限 | ✅ 無制限 |
| **個人ワークフロー編集** | ✅ 自分のみ | ✅ 自分のみ | ✅ 自分のみ | ✅ 自分のみ |
| **個人ワークフロー削除** | ✅ 自分のみ | ✅ 自分のみ | ✅ 自分のみ | ✅ 自分のみ |
| **個人ワークフロー複製** | ✅ 無制限 | ✅ 無制限 | ✅ 無制限 | ✅ 無制限 |
| **個人カスタムステータス作成** | ✅ 無制限 | ✅ 無制限 | ✅ 無制限 | ✅ 無制限 |
| **個人工数テンプレート管理** | ✅ 無制限 | ✅ 無制限 | ✅ 無制限 | ✅ 無制限 |
| **個人設定エクスポート** | ✅ 可能 | ✅ 可能 | ✅ 可能 | ✅ 可能 |
| **個人設定インポート** | ✅ 可能 | ✅ 可能 | ✅ 可能 | ✅ 可能 |

## 2️⃣ チーム・プロジェクトワークフロー権限

| 操作項目 | USER | TEAM_LEADER | MANAGER | COMPANY_LEADER |
|---------|------|-------------|---------|----------------|
| **チームワークフロー作成** | 🔒 提案→承認 | ✅ 直接作成 | ✅ 直接作成 | ✅ 直接作成 |
| **チームワークフロー編集** | 🔒 提案→承認 | ✅ チーム内 | ✅ 管轄内 | ✅ 全社 |
| **チームワークフロー削除** | ❌ 不可 | ✅ チーム内 | ✅ 管轄内 | ✅ 全社 |
| **プロジェクトワークフロー適用** | 🔒 承認必要 | ✅ チーム内 | ✅ 管轄内 | ✅ 全社 |
| **チーム工数テンプレート作成** | 🔒 提案のみ | ✅ 作成可能 | ✅ 作成可能 | ✅ 作成可能 |
| **共有ステータス定義** | 🔒 提案のみ | ✅ チーム内 | ✅ 部門内 | ✅ 全社 |
| **承認フロー設定** | ❌ 不可 | ✅ チーム内 | ✅ 部門内 | ✅ 全社 |
| **プロジェクトメンバー管理** | 👁️ 閲覧のみ | ✅ チーム内 | ✅ 部門内 | ✅ 全社 |

## 3️⃣ 企業レベルワークフロー権限

| 操作項目 | USER | TEAM_LEADER | MANAGER | COMPANY_LEADER |
|---------|------|-------------|---------|----------------|
| **企業ワークフローテンプレート作成** | ❌ 不可 | ❌ 不可 | 🔒 提案→承認 | ✅ 直接作成 |
| **企業ワークフローテンプレート編集** | ❌ 不可 | ❌ 不可 | 🔒 提案→承認 | ✅ 直接編集 |
| **企業標準ステータス定義** | ❌ 不可 | 🔒 提案のみ | 🔒 提案→承認 | ✅ 直接定義 |
| **全社工数テンプレート管理** | 👁️ 閲覧のみ | 👁️ 閲覧のみ | 🔒 提案→承認 | ✅ 完全管理 |
| **企業ワークフロー強制適用** | ❌ 不可 | ❌ 不可 | ❌ 不可 | ✅ 可能 |
| **ワークフロー利用統計閲覧** | 👁️ 個人分のみ | 👁️ チーム内 | 👁️ 部門内 | 👁️ 全社 |
| **企業設定エクスポート** | ❌ 不可 | ❌ 不可 | 👁️ 閲覧のみ | ✅ 可能 |
| **企業設定インポート** | ❌ 不可 | ❌ 不可 | ❌ 不可 | ✅ 可能 |

## 4️⃣ ステータス遷移制御マトリックス

### 個人タスクでのステータス遷移

| FROM → TO | USER | TEAM_LEADER | MANAGER | COMPANY_LEADER |
|-----------|------|-------------|---------|----------------|
| **TODO → IN_PROGRESS** | ✅ 自由 | ✅ 自由 | ✅ 自由 | ✅ 自由 |
| **IN_PROGRESS → REVIEW_READY** | ✅ 自由 | ✅ 自由 | ✅ 自由 | ✅ 自由 |
| **REVIEW_READY → DONE** | ✅ 自由 | ✅ 自由 | ✅ 自由 | ✅ 自由 |
| **ANY → BLOCKED** | ✅ 自由 | ✅ 自由 | ✅ 自由 | ✅ 自由 |
| **BLOCKED → ANY** | ✅ 自由 | ✅ 自由 | ✅ 自由 | ✅ 自由 |
| **カスタムステータス遷移** | ✅ 自由 | ✅ 自由 | ✅ 自由 | ✅ 自由 |

### 共有タスクでのステータス遷移

| FROM → TO | 担当者 | チーム内他メンバー | 上位権限者 | 承認者のみ |
|-----------|--------|---------------|-----------|-----------|
| **TODO → IN_PROGRESS** | ✅ 可能 | 👁️ 閲覧のみ | ✅ 可能 | ✅ 可能 |
| **IN_PROGRESS → APPROVAL_WAITING** | ✅ 可能 | 👁️ 閲覧のみ | ✅ 可能 | ✅ 可能 |
| **APPROVAL_WAITING → APPROVED** | ❌ 不可 | ❌ 不可 | 🎯 権限次第 | ✅ 承認者のみ |
| **APPROVED → DONE** | ✅ 可能 | 👁️ 閲覧のみ | ✅ 可能 | ✅ 可能 |
| **ANY → CLIENT_REVIEW** | ✅ 担当者 | ❌ 不可 | ✅ 可能 | ✅ 可能 |
| **CLIENT_REVIEW → CLIENT_APPROVED** | ❌ 不可 | ❌ 不可 | 🔒 特別承認 | 🔒 クライアント権限 |
| **ANY → REJECTED** | ❌ 不可 | ❌ 不可 | ✅ 可能 | ✅ 承認者のみ |

## 5️⃣ 承認フロー制御マトリックス

### 承認権限の階層構造

| 承認対象 | 必要権限レベル | 承認可能ロール | 承認条件 |
|---------|---------------|---------------|---------|
| **個人→チーム遷移** | チームリーダー以上 | TEAM_LEADER+ | 同一チーム |
| **チーム→部門遷移** | マネージャー以上 | MANAGER+ | 同一部門 |
| **部門→全社遷移** | 企業統括者 | COMPANY_LEADER | 企業内 |
| **カスタムステータス承認** | 作成レベル+1 | 上位権限 | 階層準拠 |
| **緊急承認** | マネージャー以上 | MANAGER+ | 理由記録必須 |
| **承認取り消し** | 原承認者以上 | 同等以上 | ログ記録 |

### 承認タイムアウト制御

| 承認タイプ | タイムアウト | エスカレーション | 自動処理 |
|-----------|-------------|----------------|---------|
| **通常承認** | 72時間 | +1レベル上位 | 自動承認 |
| **緊急承認** | 24時間 | +1レベル上位 | 自動承認 |
| **企業レベル承認** | 168時間（1週間） | COMPANY_LEADER | 保留維持 |
| **カスタム承認** | 設定可能 | 設定可能 | 設定可能 |

## 6️⃣ データアクセス制御マトリックス

### ワークフローデータの閲覧権限

| データ種別 | USER | TEAM_LEADER | MANAGER | COMPANY_LEADER |
|-----------|------|-------------|---------|----------------|
| **個人ワークフロー** | 👁️ 自分のみ | 👁️ 自分のみ | 👁️ 自分のみ | 👁️ 自分のみ |
| **チームワークフロー** | 👁️ 参加分のみ | 👁️ チーム内全て | 👁️ 管轄内全て | 👁️ 全社全て |
| **他ユーザーの個人設定** | ❌ 不可 | ❌ 不可 | ❌ 不可 | ❌ 不可 |
| **工数データ** | 👁️ 自分のみ | 👁️ チーム集計 | 👁️ 部門集計 | 👁️ 全社集計 |
| **承認履歴** | 👁️ 関与分のみ | 👁️ チーム内 | 👁️ 部門内 | 👁️ 全社 |
| **システム設定** | ❌ 不可 | 👁️ チーム設定 | 👁️ 部門設定 | 👁️ 全社設定 |

### ワークフローデータの編集権限

| データ種別 | USER | TEAM_LEADER | MANAGER | COMPANY_LEADER |
|-----------|------|-------------|---------|----------------|
| **自分の個人データ** | ✅ 完全編集 | ✅ 完全編集 | ✅ 完全編集 | ✅ 完全編集 |
| **チーム共有データ** | 🔒 提案のみ | ✅ 編集可能 | ✅ 編集可能 | ✅ 編集可能 |
| **他ユーザーのタスク** | ❌ 不可 | 🎯 チーム内のみ | 🎯 部門内のみ | 🎯 全社 |
| **承認済みデータ** | ❌ 不可 | 🔒 再承認必要 | 🔒 再承認必要 | ✅ 直接編集 |
| **履歴データ** | ❌ 不可 | ❌ 不可 | ❌ 不可 | 👁️ 閲覧のみ |

## 7️⃣ API エンドポイント権限マッピング

### ワークフロー管理API

| エンドポイント | USER | TEAM_LEADER | MANAGER | COMPANY_LEADER |
|---------------|------|-------------|---------|----------------|
| `GET /api/workflows/templates` | 👁️ 自分+参加分 | 👁️ チーム内 | 👁️ 部門内 | 👁️ 全社 |
| `POST /api/workflows/templates` | 🎯 個人のみ | ✅ チーム作成 | ✅ 部門作成 | ✅ 全社作成 |
| `PUT /api/workflows/templates/:id` | 🎯 自分のみ | 🎯 チーム内 | 🎯 部門内 | ✅ 全社 |
| `DELETE /api/workflows/templates/:id` | 🎯 自分のみ | 🎯 チーム内 | 🎯 部門内 | ✅ 全社 |
| `GET /api/workflows/settings` | 👁️ 自分のみ | 👁️ 自分のみ | 👁️ 自分のみ | 👁️ 自分のみ |
| `PUT /api/workflows/settings` | ✅ 自分のみ | ✅ 自分のみ | ✅ 自分のみ | ✅ 自分のみ |
| `GET /api/workflows/settings/user/:userId` | ❌ 不可 | 🎯 チーム内 | 🎯 部門内 | ✅ 全社 |
| `PUT /api/workflows/settings/user/:userId` | ❌ 不可 | ❌ 不可 | ❌ 不可 | 🔒 緊急時のみ |
| `GET /api/workflows/effort-templates` | 👁️ 自分+参加分 | 👁️ チーム内 | 👁️ 部門内 | 👁️ 全社 |
| `POST /api/workflows/effort-templates` | ✅ 個人作成 | ✅ チーム作成 | ✅ 部門作成 | ✅ 全社作成 |

### 承認フローAPI

| エンドポイント | USER | TEAM_LEADER | MANAGER | COMPANY_LEADER |
|---------------|------|-------------|---------|----------------|
| `POST /api/workflows/approval/request` | ✅ 申請可能 | ✅ 申請可能 | ✅ 申請可能 | ✅ 申請可能 |
| `POST /api/workflows/approval/approve` | 🎯 権限次第 | 🎯 チーム内 | 🎯 部門内 | ✅ 全社 |
| `POST /api/workflows/approval/reject` | 🎯 権限次第 | 🎯 チーム内 | 🎯 部門内 | ✅ 全社 |
| `GET /api/workflows/approval/pending` | 👁️ 自分関連 | 👁️ チーム内 | 👁️ 部門内 | 👁️ 全社 |
| `GET /api/workflows/approval/history` | 👁️ 自分関連 | 👁️ チーム内 | 👁️ 部門内 | 👁️ 全社 |

## 8️⃣ 特別権限・例外処理

### 緊急時権限

| 状況 | 発動条件 | 可能操作 | 必要承認 | ログ記録 |
|------|---------|---------|---------|---------|
| **システム障害** | COMPANY_LEADER判断 | 全操作可能 | 事後承認 | 必須 |
| **セキュリティインシデント** | MANAGER以上判断 | 制限操作 | 事後承認 | 必須 |
| **業務緊急対応** | TEAM_LEADER以上判断 | 範囲内操作 | 同時承認 | 必須 |
| **監査対応** | COMPANY_LEADER承認 | 読み取り専用 | 事前承認 | 必須 |

### データ移行・バックアップ権限

| 操作 | USER | TEAM_LEADER | MANAGER | COMPANY_LEADER |
|------|------|-------------|---------|----------------|
| **個人データエクスポート** | ✅ 自分のみ | ✅ 自分のみ | ✅ 自分のみ | ✅ 自分のみ |
| **チームデータエクスポート** | ❌ 不可 | ✅ チーム内 | ✅ 部門内 | ✅ 全社 |
| **システムバックアップ** | ❌ 不可 | ❌ 不可 | ❌ 不可 | ✅ 可能 |
| **データ復元** | ❌ 不可 | 🔒 要申請 | 🔒 要申請 | ✅ 可能 |

## 9️⃣ 監査・コンプライアンス

### 操作ログ記録レベル

| 操作種別 | ログレベル | 保存期間 | アクセス権限 |
|---------|-----------|---------|-------------|
| **個人ワークフロー操作** | INFO | 1年 | 本人のみ |
| **チームワークフロー操作** | INFO | 2年 | チーム内 |
| **承認操作** | AUDIT | 5年 | 管理者のみ |
| **権限変更** | AUDIT | 永続 | COMPANY_LEADER |
| **エラー・例外** | ERROR | 2年 | 管理者のみ |
| **セキュリティ関連** | SECURITY | 永続 | COMPANY_LEADER |

### コンプライアンスチェック

| チェック項目 | 実行タイミング | 対象ロール | 違反時処理 |
|-------------|---------------|-----------|-----------|
| **権限濫用チェック** | 毎日 | 全ロール | アラート + 制限 |
| **データアクセス異常** | リアルタイム | 全ロール | 即時ブロック |
| **承認フロー逸脱** | 承認時 | 承認者 | 承認無効化 |
| **企業間データ漏洩** | リアルタイム | 全ロール | 即時遮断 |

---

**作成日**: 2025-07-29  
**作成者**: ★4認証システムアーキテクター  
**適用システム**: 最強タスク管理ツール  
**次回レビュー**: ★8バックエンド実装前